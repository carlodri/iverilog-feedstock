{% set version = "10.2" %}

package:
  name: iverilog
  version: {{ version }}

source:
  url: https://github.com/steveicarus/iverilog/archive/{{ version | replace(".", "_") }}.tar.gz
  sha256: f54d91821223c71c70f4735a1fb2af39c62efbccdeb9b0060ea1cf9c67647ee3
  patches: 5bb6c7f53a6ab5b44c282ba5b118927fd4f17e4f.patch  # [not win]

build:
  number: 4
  detect_binary_files_with_prefix: True

requirements:
  build:
    - autoconf  # [not win]
    - {{ compiler('c') }}  # [not win]
    - {{ compiler('cxx') }}  # [not win]
    - {{ compiler('m2w64_c') }}  # [win]
    - {{ compiler('m2w64_cxx') }}  # [win]
    - m2-autoconf  # [win]
    - m2-make  # [win]
    - m2-grep  # [win]
    - m2-bison  # [win]
    - m2-sed  # [win]
    - m2-bash  # [win]
  host:
    - gperf  # [not win]
    - bison  # [not win]
    - flex  # [not win]
    - readline  # [not win]
    - m2-libreadline  # [win]
    - m2-gperf  # [win]
    - m2-flex  # [win]
    - zlib

test:
  commands:
    - test -f "${PREFIX}/bin/iverilog"  # [unix]
    - test -f "${PREFIX}/bin/iverilog-vpi"  # [unix]
    - test -f "${PREFIX}/bin/vvp"  # [unix]
    - test -f "${PREFIX}/lib/libveriuser.a"  # [unix]
    - test -f "${PREFIX}/lib/libvpi.a"  # [unix]
    - test -f "${PREFIX}/lib/ivl/ivl"  # [unix]
    - test -f "${PREFIX}/lib/ivl/ivlpp"  # [unix]
    - test -f "${PREFIX}/lib/ivl/vhdlpp"  # [unix]
    - iverilog -V
    - vvp -V

about:
  home: http://iverilog.icarus.com/home
  license: GPL-2.0
  summary: 'Icarus Verilog is intended to compile ALL of the Verilog HDL as described in the IEEE-1364 standard.'

extra:
  recipe-maintainers:
    - tfors
    - carlodri
